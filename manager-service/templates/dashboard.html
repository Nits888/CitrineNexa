<!DOCTYPE html>
<html>
<style>
    .status-green {
        background-color: #00ff00; /* Green background */
    }
    .status-amber {
        background-color: #ffbf00; /* Amber background */
    }
    .status-red {
        background-color: #ff0000; /* Red background */
    }
</style>
<head>
    <title>RAG Status Dashboard</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.0/css/bootstrap.min.css">
</head>
<body>
    <div class="container mt-5">
        <h1>RAG Status Dashboard</h1>
        <div class="row">
            <div class="col">
                <table class="table table-striped">
                    <thead>
                        <tr>
                            <th>App Name</th>
                            <th>Endpoint</th>
                            <th>Issuer</th>
                            <th>Expiry Date</th>
                            <th>RAG Status</th>
                        </tr>
                    </thead>
                    <tbody id="table-body">
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <script>
      // Fetch and populate data
    fetch('/data')
    .then(response => response.json())
    .then(data => {
        const tableBody = document.getElementById('table-body');

        for (const app in data) {
            for (const endpoint in data[app]) {
                const entry = data[app][endpoint];
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${app}</td>
                    <td>${endpoint}</td>
                    <td>${entry.issuer[entry.issuer.length - 1][1]}</td>
                    <td>${entry.expiry_date}</td>
                    <td class="status-${entry.RAG_status.toLowerCase()}">${entry.RAG_status}</td> <!-- Set CSS class for RAG Status -->
                `;
                tableBody.appendChild(row);
            }
        }
    });
    </script>
</body>
</html>
